# 字节二面

[链接](https://www.nowcoder.com/discuss/553458)

[高并发系统设计](https://zhuanlan.zhihu.com/p/269609872)

## 1.秒杀系统主要为了提升什么

秒杀系统难点往往是短时间内对数据进行读写，然后造成读写上的一些冲突,甚至锁非常严重.当然知道难点在哪里,我们自然就有办法解决,人类智慧无限,办法总比困难多. 简单说来也就两点,`限流和提升关键点`的性能.

（1）限流,将请求尽量拦截在系统上游,流量层层过滤,当请求到达稀缺资源比如数据库的时候,流量变小,数据库的压力已经可以忽略.传统秒杀系统之所以挂，请求都压倒了后端数据层，数据读写锁冲突严重，并发高响应慢，几乎所有请求都超时，流量虽大，下单成功的有效流量甚小。

（2）提升关键点的性能,充分利用缓存便是一个不错的提升性能的方式.因为数据库的性能提升往往比较困难,而人们换个思考问题的方式, 既然数据库性能提升不容易,那换一个性能高的数据存储的地方总可以,缓存便是这种思路下产生的,缓存数据存放在内存中,处理的速度远大于数据库,这样便换角度的提升了数据访问的性能

各层次优化细节

客户端怎么优化（浏览器层，APP层）

设计:用户点击一次提交以后不再允许能够提交,比如将按钮置灰.
技术:可以使用js限制用户点击,提交的次数,例如一分钟之内只能点击一次.
这样在最上层,通过设计与技术手段就能够阻拦80%以上的流量,虽然如何但剩余的流量依然很大.所以还需要继续阻击.

代理层面的请求拦截

这里我们为了分担后端服务器压力,往往使用反向代理服务器,例如nginx, 这个地方可以配置nginx限流措施,比如单位时间只能有5万的访问量,这个时候再一次的阻拦了一部分流量.

站点层面的请求拦截

在站点层面，对用户id(当然需要登录)进行请求计数和去重。一个用户id，单位时间内(比如5秒)只准透过1个请求，这样又能拦住一大部分的请求。只透过一个请求，其余的请求怎么办？缓存，页面缓存，同一个用户id，限制访问频度，做页面缓存，单位时间内到达站点层的请求，均返回同一页面。同一个item的查询。

服务层来拦截

对于写请求，做请求队列，每次只透有限的写请求去数据层

对于读请求，用缓存，不管是memcached还是redis，单机抗个每秒10w应该都是没什么问题的。如此限流，只有非常少的写请求，和非常少的读缓存mis的请求会透到数据层去，又有99.9%的请求被拦住了。

数据库层

当数据经过层层阻击到达数据层的时候,流量已经过滤掉了绝大部分，服务层又做了写请求队列与数据缓存，每次透到数据库层的请求都是可控的。db基本就没什么压力了，闲庭信步，单机也能扛得住。

## 2.从一个大的思路上，怎么提升QPS。 （面试官提示说冷热分离这个角度，我从动静分离、缓存、限流说，面试官一直说要从宏观角度说。。。有没有大佬知道怎么回答？）





## 3.登录怎么做。判断用户是否登录。怎么判断以前是否登陆过的。sessionId是什么。sessionId什么时候生成的

## 4.content-type了解吗

MediaType，即是Internet Media Type，互联网媒体类型；也叫做MIME类型，在Http协议消息头中，使用Content-Type来表示具体请求中的媒体类型信息。

在HTTP协议消息头中，使用Content-Type来表示请求和响应中的媒体类型信息。它用来告诉服务端如何处理请求的数据，以及告诉客户端（一般是浏览器）如何解析响应的数据，比如显示图片，解析并展示html等等。

## 5.如何在贴吧上制造csrf攻击，如何在贴吧制造 xss攻击

CSRF概念：CSRF跨站点请求伪造(Cross—Site Request Forgery)，跟XSS攻击一样，存在巨大的危害性，你可以这样来理解：

攻击者盗用了你的身份，以你的名义发送恶意请求，对服务器来说这个请求是完全合法的，但是却完成了攻击者所期望的一个操作，比如以你的名义发送邮件、发消息，盗取你的账号，添加系统管理员，甚至于购买商品、虚拟货币转账等。 如下：其中Web A为存在CSRF漏洞的网站，Web B为攻击者构建的恶意网站，User C为Web A网站的合法用户。

跨站脚本攻击（XSS），是最普遍的Web应用安全漏洞。这类漏洞能够使得攻击者嵌入恶意脚本代码到正常用户会访问到的页面中，当正常用户访问该页面时，则可导致嵌入的恶意脚本代码的执行，从而达到恶意攻击用户的目的。

## 6.实现一个排他锁。 lock() 的返回值是什么。如果lock() 返回值是 void，怎么做到排他

## 7.ArrayList扩容

扩容后的引用地址是不是改变。
ArrayList下标访问的时间复杂度。为什么数组就是O(1)。
弱类型语言，像python，php，如何做到O(1)的时间复杂度

## 8.gc日志的报警，怎么设置报警规则

## 9.MySQL 有一个表 user表，有两个字段 userid, userdata。 ( userdata是json格式，有很多数据，包括name, age等等)

设计一个接口，传入一个id， 和任意类型的数据，比如age，name，然后对特定的数据进行修改。 SQL怎么写

两个设备下，一个设备修改age，另一个设备修改name，同时修改，但是最后发现age修改成功了，name没有修改成功，为什么？

加了事务还是会，怎么解决

除了 select... for update 还有什么思路吗

## 10. 10.101.102.103是公网IP还是内网IP，如何区分公网内网

设计一个算法，将一个IP转成一个int。

## 11.从理论上讲，有多少个设备可以访问 Google，从客户端角度思考。（思考角度包括IP地址个数，公网私网，NAT，APR，MAC等）

## 12.算法题，实现 一个IP地址（10.101.102.103）转成int类型数据。 （IP地址是32个比特，int也是32个比特）
